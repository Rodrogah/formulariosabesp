<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formul√°rio de Inspe√ß√£o</title>
    <style>
        :root {
            --color-bg-base: #0f172a;
            --color-bg-elevated: #020617;
            --color-bg-surface: #1e293b;
            --color-bg-muted: #334155;
            --color-text-primary: #f1f5f9;
            --color-text-secondary: #cbd5e1;
            --color-text-muted: #94a3b8;
            --color-primary: #38bdf8;
            --color-primary-hover: #0ea5e9;
            --color-border: rgba(119, 124, 124, 0.3);
            --color-success: #10b981;
        }

        @media (prefers-color-scheme: light) {
            :root {
                --color-bg-base: #ffffff;
                --color-bg-elevated: #f8fafc;
                --color-bg-surface: #f1f5f9;
                --color-bg-muted: #e2e8f0;
                --color-text-primary: #0f172a;
                --color-text-secondary: #475569;
                --color-text-muted: #64748b;
                --color-primary: #0284c7;
                --color-primary-hover: #0369a1;
                --color-border: rgba(94, 82, 64, 0.2);
                --color-success: #059669;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-bg-base);
            color: var(--color-text-primary);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--color-bg-surface);
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: var(--color-primary);
            margin-bottom: 8px;
            font-size: 28px;
        }

        h2 {
            color: var(--color-primary);
            margin-top: 32px;
            margin-bottom: 16px;
            font-size: 20px;
            border-bottom: 2px solid var(--color-primary);
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--color-text-secondary);
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        input[type="tel"],
        textarea,
        select {
            width: 100%;
            padding: 10px 12px;
            background: var(--color-bg-base);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            color: var(--color-text-primary);
            font-size: 14px;
            transition: border-color 0.2s;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .radio-group,
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-top: 8px;
        }

        .radio-item,
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="radio"],
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .conditional-field {
            margin-top: 12px;
            padding-left: 24px;
            display: none;
        }

        .conditional-field.show {
            display: block;
        }

        .photo-upload {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 12px;
        }

        .photo-group {
            background: var(--color-bg-base);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
        }

        .photo-group h3 {
            color: var(--color-text-secondary);
            font-size: 16px;
            margin-bottom: 12px;
        }

        .photo-input {
            margin-bottom: 8px;
        }

        input[type="file"] {
            padding: 8px;
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            color: var(--color-text-primary);
            cursor: pointer;
            width: 100%;
        }

        .photo-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .photo-preview img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid var(--color-border);
        }

        .signature-box {
            background: var(--color-bg-base);
            border: 2px dashed var(--color-border);
            border-radius: 8px;
            padding: 16px;
            min-height: 120px;
            margin-top: 8px;
        }

        .btn {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 32px;
        }

        .btn:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: var(--color-bg-muted);
            margin-left: 12px;
        }

        .btn-secondary:hover {
            background: var(--color-text-muted);
        }

        .page-break {
            page-break-before: always;
            margin-top: 40px;
            padding-top: 40px;
            border-top: 3px solid var(--color-primary);
        }

        .success-message {
            background: var(--color-success);
            color: white;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
            }
            .btn {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Formul√°rio de Inspe√ß√£o - Tina 2</h1>
        <p style="color: var(--color-text-secondary); margin-bottom: 24px;">
            Preencha todos os campos necess√°rios para a inspe√ß√£o do im√≥vel.
        </p>

        <div id="successMessage" class="success-message">
            Formul√°rio salvo com sucesso!
        </div>

        <form id="inspectionForm">
            <!-- Informa√ß√µes B√°sicas -->
            <h2>Informa√ß√µes B√°sicas</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="superintendencia">Superintend√™ncia:</label>
                    <input type="text" id="superintendencia" name="superintendencia" required>
                </div>
                
                <div class="form-group">
                    <label for="municipio">Munic√≠pio:</label>
                    <input type="text" id="municipio" name="municipio" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="pde">PDE:</label>
                    <input type="text" id="pde" name="pde" required>
                </div>
                
                <div class="form-group">
                    <label for="hidrometro">N¬∫ do Hidr√¥metro:</label>
                    <input type="text" id="hidrometro" name="hidrometro" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="economias">N¬∫ Economias:</label>
                    <input type="number" id="economias" name="economias" required>
                </div>
                
                <div class="form-group">
                    <label for="moradores">N¬∫ Moradores:</label>
                    <input type="number" id="moradores" name="moradores" required>
                </div>
            </div>

            <div class="form-group">
                <label for="entreNumeros">Entre os N¬∫s:</label>
                <input type="text" id="entreNumeros" name="entreNumeros" placeholder="Ex: 100 e 150">
            </div>

            <div class="form-group">
                <label for="endereco">Endere√ßo do im√≥vel:</label>
                <input type="text" id="endereco" name="endereco" required>
            </div>

            <!-- Dados do Propriet√°rio -->
            <h2>Dados do Propriet√°rio</h2>

            <div class="form-row">
                <div class="form-group">
                    <label for="rg">RG:</label>
                    <input type="text" id="rg" name="rg" required>
                </div>
                
                <div class="form-group">
                    <label for="cpf">CPF:</label>
                    <input type="text" id="cpf" name="cpf" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="telefone1">Telefone 1:</label>
                    <input type="tel" id="telefone1" name="telefone1" required>
                </div>
                
                <div class="form-group">
                    <label for="telefone2">Telefone 2:</label>
                    <input type="tel" id="telefone2" name="telefone2">
                </div>
            </div>

            <!-- Informa√ß√µes da Liga√ß√£o -->
            <h2>Informa√ß√µes da Liga√ß√£o</h2>

            <div class="form-group">
                <label>Liga√ß√£o:</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="tipoI" name="tipoLigacao" value="Tipo I" required>
                        <label for="tipoI">Tipo I</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="tipoII" name="tipoLigacao" value="Tipo II">
                        <label for="tipoII">Tipo II</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Situa√ß√£o da Liga√ß√£o:</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="parcial" name="situacaoLigacao" value="Parcial" required>
                        <label for="parcial">Parcial</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="total" name="situacaoLigacao" value="Total">
                        <label for="total">Total</label>
                    </div>
                </div>
            </div>

            <!-- Pavimenta√ß√£o -->
            <h2>Pavimenta√ß√£o</h2>

            <div class="form-group">
                <label for="pavimentoInterno">Pavimento Interno:</label>
                <select id="pavimentoInterno" name="pavimentoInterno" required>
                    <option value="">Selecione...</option>
                    <option value="Terra">Terra</option>
                    <option value="Cimentado">Cimentado</option>
                    <option value="Cer√¢mica">Cer√¢mica</option>
                    <option value="Outros">Outros</option>
                </select>
            </div>

            <div class="form-group">
                <label for="pavimentoExterno">Pavimento Externo:</label>
                <select id="pavimentoExterno" name="pavimentoExterno" required>
                    <option value="">Selecione...</option>
                    <option value="Terra">Terra</option>
                    <option value="Cimentado">Cimentado</option>
                    <option value="Especial">Especial</option>
                    <option value="Outros">Outros</option>
                </select>
            </div>

            <!-- Situa√ß√£o de Esgotamento -->
            <h2>Situa√ß√£o de Esgotamento</h2>

            <div class="form-group">
                <label for="esgotamento">Situa√ß√£o de esgotamento atual do im√≥vel:</label>
                <select id="esgotamento" name="esgotamento" required>
                    <option value="">Selecione...</option>
                    <option value="C√©u aberto">C√©u aberto</option>
                    <option value="Fossa">Fossa</option>
                    <option value="C√≥rrego">C√≥rrego</option>
                    <option value="GAP">GAP</option>
                </select>
            </div>

            <div class="form-group">
                <label>Localiza√ß√£o do esgotamento:</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="frente" name="localizacaoEsgoto" value="Frente" required>
                        <label for="frente">Frente</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="lateral" name="localizacaoEsgoto" value="Lateral">
                        <label for="lateral">Lateral</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="fundos" name="localizacaoEsgoto" value="Fundos">
                        <label for="fundos">Fundos</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Caixa de inspe√ß√£o vis√≠vel:</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="caixaSim" name="caixaInspecao" value="Sim" required>
                        <label for="caixaSim">Sim</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="caixaNao" name="caixaInspecao" value="N√£o">
                        <label for="caixaNao">N√£o</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Interliga√ß√£o de √°gua de chuva:</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="chuvaSim" name="aguaChuva" value="Sim" required>
                        <label for="chuvaSim">Sim</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="chuvaNao" name="aguaChuva" value="N√£o">
                        <label for="chuvaNao">N√£o</label>
                    </div>
                </div>
            </div>

            <div id="ondeAguaChuva" class="conditional-field">
                <label for="localAguaChuva">Onde:</label>
                <input type="text" id="localAguaChuva" name="localAguaChuva">
            </div>

            <!-- Informa√ß√µes Gerais -->
            <h2>Informa√ß√µes Gerais</h2>

            <div class="form-group">
                <label for="infoGerais">Informa√ß√µes gerais:</label>
                <textarea id="infoGerais" name="infoGerais" placeholder="Descreva observa√ß√µes relevantes sobre a inspe√ß√£o..."></textarea>
            </div>

            <!-- Fotos -->
            <h2>Fotos Antes da Execu√ß√£o das Obras</h2>

            <div class="photo-upload">
                <div class="photo-group">
                    <h3>Fotos Externas</h3>
                    <input type="file" id="fotosExternasAntes" name="fotosExternasAntes" accept="image/*" multiple class="photo-input">
                    <div id="previewExternasAntes" class="photo-preview"></div>
                </div>

                <div class="photo-group">
                    <h3>Fotos Internas</h3>
                    <input type="file" id="fotosInternasAntes" name="fotosInternasAntes" accept="image/*" multiple class="photo-input">
                    <div id="previewInternasAntes" class="photo-preview"></div>
                </div>

                <div class="photo-group">
                    <h3>Passagem de Servid√£o</h3>
                    <input type="file" id="fotosServidaoAntes" name="fotosServidaoAntes" accept="image/*" multiple class="photo-input">
                    <div id="previewServidaoAntes" class="photo-preview"></div>
                </div>
            </div>

            <h2>Fotos Depois da Execu√ß√£o das Obras</h2>

            <div class="photo-upload">
                <div class="photo-group">
                    <h3>Fotos Externas</h3>
                    <input type="file" id="fotosExternasDepois" name="fotosExternasDepois" accept="image/*" multiple class="photo-input">
                    <div id="previewExternasDepois" class="photo-preview"></div>
                </div>

                <div class="photo-group">
                    <h3>Fotos Internas</h3>
                    <input type="file" id="fotosInternasDepois" name="fotosInternasDepois" accept="image/*" multiple class="photo-input">
                    <div id="previewInternasDepois" class="photo-preview"></div>
                </div>

                <div class="photo-group">
                    <h3>Passagem de Servid√£o</h3>
                    <input type="file" id="fotosServidaoDepois" name="fotosServidaoDepois" accept="image/*" multiple class="photo-input">
                    <div id="previewServidaoDepois" class="photo-preview"></div>
                </div>
            </div>

            <!-- Assinaturas e Data -->
            <h2>Assinaturas e Data</h2>

            <div class="form-group">
                <label for="assinaturaCliente">Assinatura do Cliente:</label>
                <div class="signature-box">
                    <input type="text" id="assinaturaCliente" name="assinaturaCliente" placeholder="Digite o nome para assinatura">
                </div>
            </div>

            <div class="form-group">
                <label for="responsavelInspecao">Respons√°vel pela inspe√ß√£o:</label>
                <div class="signature-box">
                    <input type="text" id="responsavelInspecao" name="responsavelInspecao" placeholder="Digite o nome do respons√°vel">
                </div>
            </div>

            <div class="form-group">
                <label for="dataInspecao">Data:</label>
                <input type="date" id="dataInspecao" name="dataInspecao" required>
            </div>

            <!-- Bot√µes -->
            <div style="margin-top: 32px; display: flex; gap: 12px; flex-wrap: wrap;">
                <button type="submit" class="btn" style="margin: 0;">Gerar Relat√≥rio</button>
                <button type="button" class="btn btn-secondary" onclick="limparFormulario()" style="margin: 0;">Limpar Formul√°rio</button>
                <button type="button" class="btn" onclick="exportarDados()" style="background: var(--color-success); margin: 0;">üìÑ Gerar PDF Preenchido</button>
            </div>
        </form>

        <!-- P√°gina de Fotos -->
        <div id="paginaFotos" class="page-break" style="display: none;">
            <h1>Registro Fotogr√°fico</h1>
            
            <h2>Fotos Antes da Execu√ß√£o das Obras</h2>
            
            <div style="margin-bottom: 32px;">
                <h3 style="color: var(--color-text-secondary); font-size: 18px; margin-bottom: 12px;">Fotos Externas</h3>
                <div id="displayExternasAntes" class="photo-preview"></div>
            </div>

            <div style="margin-bottom: 32px;">
                <h3 style="color: var(--color-text-secondary); font-size: 18px; margin-bottom: 12px;">Fotos Internas</h3>
                <div id="displayInternasAntes" class="photo-preview"></div>
            </div>

            <div style="margin-bottom: 32px;">
                <h3 style="color: var(--color-text-secondary); font-size: 18px; margin-bottom: 12px;">Passagem de Servid√£o</h3>
                <div id="displayServidaoAntes" class="photo-preview"></div>
            </div>

            <h2>Fotos Depois da Execu√ß√£o das Obras</h2>
            
            <div style="margin-bottom: 32px;">
                <h3 style="color: var(--color-text-secondary); font-size: 18px; margin-bottom: 12px;">Fotos Externas</h3>
                <div id="displayExternasDepois" class="photo-preview"></div>
            </div>

            <div style="margin-bottom: 32px;">
                <h3 style="color: var(--color-text-secondary); font-size: 18px; margin-bottom: 12px;">Fotos Internas</h3>
                <div id="displayInternasDepois" class="photo-preview"></div>
            </div>

            <div style="margin-bottom: 32px;">
                <h3 style="color: var(--color-text-secondary); font-size: 18px; margin-bottom: 12px;">Passagem de Servid√£o</h3>
                <div id="displayServidaoDepois" class="photo-preview"></div>
            </div>

            <button type="button" class="btn" onclick="window.print()">Imprimir Relat√≥rio</button>
        </div>
    </div>

    <script>
        const allPhotos = {
            externasAntes: [],
            internasAntes: [],
            servidaoAntes: [],
            externasDepois: [],
            internasDepois: [],
            servidaoDepois: []
        };

        document.getElementById('chuvaSim').addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('ondeAguaChuva').classList.add('show');
            }
        });

        document.getElementById('chuvaNao').addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('ondeAguaChuva').classList.remove('show');
                document.getElementById('localAguaChuva').value = '';
            }
        });

        function setupPhotoPreview(inputId, previewId, photoKey) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);

            input.addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                allPhotos[photoKey] = files;

                preview.innerHTML = '';
                
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const img = document.createElement('img');
                        img.src = event.target.result;
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });
            });
        }

        setupPhotoPreview('fotosExternasAntes', 'previewExternasAntes', 'externasAntes');
        setupPhotoPreview('fotosInternasAntes', 'previewInternasAntes', 'internasAntes');
        setupPhotoPreview('fotosServidaoAntes', 'previewServidaoAntes', 'servidaoAntes');
        setupPhotoPreview('fotosExternasDepois', 'previewExternasDepois', 'externasDepois');
        setupPhotoPreview('fotosInternasDepois', 'previewInternasDepois', 'internasDepois');
        setupPhotoPreview('fotosServidaoDepois', 'previewServidaoDepois', 'servidaoDepois');

        document.getElementById('inspectionForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());

            displayPhotosPage();

            document.getElementById('successMessage').classList.add('show');
            setTimeout(() => {
                document.getElementById('successMessage').classList.remove('show');
            }, 3000);

            document.getElementById('paginaFotos').style.display = 'block';
            document.getElementById('paginaFotos').scrollIntoView({ behavior: 'smooth' });
        });

        function displayPhotosPage() {
            displayPhotosInSection('externasAntes', 'displayExternasAntes');
            displayPhotosInSection('internasAntes', 'displayInternasAntes');
            displayPhotosInSection('servidaoAntes', 'displayServidaoAntes');
            displayPhotosInSection('externasDepois', 'displayExternasDepois');
            displayPhotosInSection('internasDepois', 'displayInternasDepois');
            displayPhotosInSection('servidaoDepois', 'displayServidaoDepois');
        }

        function displayPhotosInSection(photoKey, displayId) {
            const displayElement = document.getElementById(displayId);
            displayElement.innerHTML = '';

            allPhotos[photoKey].forEach(file => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    displayElement.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        }

        function limparFormulario() {
            if (confirm('Tem certeza que deseja limpar todos os campos do formul√°rio?')) {
                document.getElementById('inspectionForm').reset();
                
                Object.keys(allPhotos).forEach(key => {
                    allPhotos[key] = [];
                });

                document.querySelectorAll('.photo-preview').forEach(preview => {
                    preview.innerHTML = '';
                });

                document.getElementById('ondeAguaChuva').classList.remove('show');
                document.getElementById('paginaFotos').style.display = 'none';
            }
        }

        document.getElementById('dataInspecao').valueAsDate = new Date();

        async function exportarDados() {
            const form = document.getElementById('inspectionForm');
            if (!form.checkValidity()) {
                alert('Por favor, preencha todos os campos obrigat√≥rios antes de gerar o PDF.');
                form.reportValidity();
                return;
            }

            alert('Gerando PDF preenchido... Isso pode levar alguns segundos.');

            try {
                const { PDFDocument, rgb } = await importPDFLib();
                
                const pdfBytes = await fetch('./FormulariodeInspecao-Tina2.pdf').then(res => {
                    if (!res.ok) throw new Error('PDF n√£o encontrado. Verifique se o arquivo est√° na mesma pasta.');
                    return res.arrayBuffer();
                });
                const pdfDoc = await PDFDocument.load(pdfBytes);
                
                const form = pdfDoc.getForm();
                const formData = new FormData(document.getElementById('inspectionForm'));
                const data = Object.fromEntries(formData.entries());

                try {
                    form.getTextField('superintendencia')?.setText(data.superintendencia || '');
                    form.getTextField('municipio')?.setText(data.municipio || '');
                    form.getTextField('pde')?.setText(data.pde || '');
                    form.getTextField('hidrometro')?.setText(data.hidrometro || '');
                    form.getTextField('economias')?.setText(data.economias || '');
                    form.getTextField('moradores')?.setText(data.moradores || '');
                    form.getTextField('entreNumeros')?.setText(data.entreNumeros || '');
                    form.getTextField('endereco')?.setText(data.endereco || '');
                    form.getTextField('rg')?.setText(data.rg || '');
                    form.getTextField('cpf')?.setText(data.cpf || '');
                    form.getTextField('telefone1')?.setText(data.telefone1 || '');
                    form.getTextField('telefone2')?.setText(data.telefone2 || '');
                    form.getTextField('infoGerais')?.setText(data.infoGerais || '');
                    form.getTextField('assinaturaCliente')?.setText(data.assinaturaCliente || '');
                    form.getTextField('responsavelInspecao')?.setText(data.responsavelInspecao || '');
                    form.getTextField('dataInspecao')?.setText(data.dataInspecao || '');
                    
                    if (data.tipoLigacao) form.getRadioGroup('tipoLigacao')?.select(data.tipoLigacao);
                    if (data.situacaoLigacao) form.getRadioGroup('situacaoLigacao')?.select(data.situacaoLigacao);
                    if (data.pavimentoInterno) form.getDropdown('pavimentoInterno')?.select(data.pavimentoInterno);
                    if (data.pavimentoExterno) form.getDropdown('pavimentoExterno')?.select(data.pavimentoExterno);
                    if (data.esgotamento) form.getDropdown('esgotamento')?.select(data.esgotamento);
                    if (data.localizacaoEsgoto) form.getRadioGroup('localizacaoEsgoto')?.select(data.localizacaoEsgoto);
                    if (data.caixaInspecao) form.getRadioGroup('caixaInspecao')?.select(data.caixaInspecao);
                    if (data.aguaChuva) form.getRadioGroup('aguaChuva')?.select(data.aguaChuva);
                    if (data.localAguaChuva) form.getTextField('localAguaChuva')?.setText(data.localAguaChuva);
                } catch (fieldError) {
                    console.warn('Alguns campos n√£o foram encontrados no PDF:', fieldError);
                }

                const pages = pdfDoc.getPages();
                let currentPage = pages[pages.length - 1];
                let yPosition = currentPage.getHeight() - 50;

                for (const [key, files] of Object.entries(allPhotos)) {
                    if (files.length > 0) {
                        for (const file of files) {
                            try {
                                const imageBytes = await file.arrayBuffer();
                                let image;
                                
                                if (file.type === 'image/png') {
                                    image = await pdfDoc.embedPng(imageBytes);
                                } else {
                                    image = await pdfDoc.embedJpg(imageBytes);
                                }

                                const imgWidth = 200;
                                const imgHeight = 150;

                                if (yPosition < imgHeight + 50) {
                                    currentPage = pdfDoc.addPage();
                                    yPosition = currentPage.getHeight() - 50;
                                }

                                currentPage.drawImage(image, {
                                    x: 50,
                                    y: yPosition - imgHeight,
                                    width: imgWidth,
                                    height: imgHeight
                                });

                                yPosition -= imgHeight + 20;
                            } catch (imgError) {
                                console.warn('Erro ao adicionar imagem:', imgError);
                            }
                        }
                    }
                }

                form.flatten();
                
                const pdfBytesOut = await pdfDoc.save();
                const blob = new Blob([pdfBytesOut], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Inspecao_Preenchida_${data.hidrometro || 'formulario'}_${new Date().toISOString().split('T')[0]}.pdf`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert('PDF preenchido gerado com sucesso!');
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                alert('Erro ao gerar PDF: ' + error.message + '\n\nVerifique se:\n1. O arquivo "FormulariodeInspecao-Tina2.pdf" est√° na mesma pasta do HTML\n2. Os nomes dos arquivos est√£o corretos (com mai√∫sculas/min√∫sculas)\n3. Voc√™ est√° acessando via servidor web (n√£o pode ser file:///)');
            }
        }

        async function importPDFLib() {
            if (window.PDFLib) return window.PDFLib;
            
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js';
            document.head.appendChild(script);
            
            return new Promise((resolve) => {
                script.onload = () => resolve(window.PDFLib);
            });
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>

